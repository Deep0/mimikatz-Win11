name: Build Windows EXE

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # 可选：如果项目需要 NuGet 恢复或 .NET SDK，可参考 Microsoft 文档
      - name: Setup MSBuild (adds MSBuild to PATH)
        uses: microsoft/setup-msbuild@v1

      - name: Restore NuGet packages (if applicable)
        if: exists('*.sln') || env.PROJECT_TYPE == 'dotnet'
        run: |
          nuget restore mimikatz.sln

      - name: Build with MSBuild
        # 修改为你的 solution / project 路径与配置（Release/Debug, x86/x64）
        run: |
          msbuild mimikatz.sln /p:Configuration=Release /p:Platform=x64 /m

      - name: Collect build artifacts
        run: |
          mkdir -p artifacts
          # 假设输出放在 bin\Release 下，按需修改路径
          robocopy .\MyProject\bin\Release .\artifacts /E
        shell: powershell

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: windows-exe-artifacts
          path: artifacts
